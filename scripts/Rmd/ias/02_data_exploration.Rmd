---
title: <span style="color:#005857"> Data exploration of <br> the IAS occurrences cube
subtitle: <span style="color:#47A52A"> Data mobilisation from GBIF to the EBV Data Portal<span>
author: 
  - name: "Lina Estupinan-Suarez, Emmanuel Oceguera, Miguel Fernandez"
    affiliation: "German Centre for Integrative Biodiversity Research (iDiv)"
    email: lina.estupinans@idiv.de
institute: "**Institute**: German Centre for Integrative Biodiversity Research (iDiv)"
date: "`r Sys.Date()`"
output:
 html_notebook:
    highlight: tango
---
<!-- <img src="C:\gitrepo\B-Cubed_data_mobilization\input\logos\B3_logo_full.png" style='width: 200px; position:absolute; top:0; right:0; padding:10px;'/> -->
<img src="C:\gitrepo\B-Cubed_data_mobilization\input\logos\idiv+b3.png" style='width: 400px; position:absolute; top:0; right:0; padding:10px;'/>
---


### Introduction
In this notebook we explore the occurrence data of invasive alien species (IAS) of union concern (IAS) available in GBIF until June 2024.
To do this, an IAS occurrence cube was previously created using the [occurrence cube software](https://techdocs.gbif.org/en/data-use/data-cubes) developed by GBIF under the [Biodiversity Building Blocks for policy project](https://b-cubed.eu/) (B3)
Details of the data query in GBIF are available at: [doi: 10.15468/dl.x4a25s](https://www.gbif.org/occurrence/download/0081452-240506114902167). 
The cube generation script is also part of this repository.

*Note: This series of notebooks is part of the results of the Task 3.3 of the [Biodiversity Building Blocks for policy project](https://b-cubed.eu/) funded by the European Unionâ€™s Horizon Europe Research and Innovation Programme (ID No 101059592). Additional notebooks exploring the results and calculating simple metrics are also available at the same repository.*


### Load library and input data
```{r setup, include=FALSE}
knitr::opts_chunk$set(message=FALSE, warning=FALSE)
```

```{r}
rm(list=ls())
gc()

# load requiered libraries
library(here)
library(ggplot2)
library(dplyr)
library(lubridate);
```

After loading the requiered libraries, we loaded the occurrence IAS cube obtained previously through GBIF API.

```{r}
# load IAS occurrence cube obtained via GBIF
cin <- read.csv(here(paste0("output/datacubes/csv/","0077925-240506114902167.csv")),  sep = "\t")

# load the species taxonomy only with "accepted" scientific names in the GBIF backbone taxonomy
tax <- read.csv(here("input/data/ias_10/taxonomy/List87IAS_EU_match_gbif_allaccepted.csv"))
```


### Data analysis

#### Calculate total number of occurrence
```{r}
# aggreagate occurrences at the species level
cag <- cin %>%
  group_by(specieskey) %>%
  summarize(totalOcc = sum(occurrences))
```


```{r}
# rename columns for joining datasets
colnames(tax)[colnames(tax) == "key"] <- "specieskey"

# merge data set and sort in ascending order
xout <- merge(x=cag, y=tax[,c("scientificName", "specieskey", "kingdom", "phylum", "class", "order", "family")], by="specieskey")
xout <- xout[order(xout$totalOcc), ]
write.csv(xout, here("output/summary_data/csv/summary_ias_totalOccurrences.csv"))
```

#### Identify IAS with no records in GBIF
```{r}
# find what species have no records in GBIF
noocc <- anti_join(tax, cag, by = "specieskey")
write.csv(noocc, here("output/summary_data/csv/ias_noOccurrences.csv"))
print(noocc)
```

```{r}

```


```{r}

```

```{r}

```

```{r}

```

```{r}

```